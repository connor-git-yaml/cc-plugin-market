# 产研汇总: 拆分 Speckit Driver Pro 技能命令

**特性分支**: `013-split-skill-commands`
**汇总日期**: 2026-02-15
**输入**: [product-research.md](product-research.md) + [tech-research.md](tech-research.md)
**执行者**: 主编排器（非子代理）

## 1. 产品×技术交叉分析矩阵

| MVP 功能 | 产品优先级 | 技术可行性 | 实现复杂度 | 综合评分 | 建议 |
|---------|-----------|-----------|-----------|---------|------|
| 创建 `skills/run/SKILL.md` | P0 | 高 | 低 | ⭐⭐⭐ | 纳入 MVP — 主编排流程，核心功能载体 |
| 创建 `skills/resume/SKILL.md` | P0 | 高 | 低 | ⭐⭐⭐ | 纳入 MVP — 差异化卖点（竞品无独立 resume 命令） |
| 创建 `skills/sync/SKILL.md` | P0 | 高 | 低 | ⭐⭐⭐ | 纳入 MVP — 渐进式采用入口，最轻量级技能 |
| 删除 `skills/speckit-driver-pro/` | P0 | 高 | 低 | ⭐⭐⭐ | 纳入 MVP — 完成迁移闭环 |
| Frontmatter 差异化配置 | P0 | 高 | 低 | ⭐⭐⭐ | 纳入 MVP — 直接影响命令发现和自动触发体验 |
| 共享工具模块（`_shared/`） | P2 | 高 | 中 | ⭐⭐ | 二期 — 仅 60 行重复，维护成本可控 |
| 命令别名支持 | P2 | 不可行 | — | ⭐ | 排除 — 平台不支持技能别名机制 |
| 交叉引用提示 | P2 | 高 | 低 | ⭐⭐ | 二期 — 在每个 SKILL.md 末尾添加相关命令提示 |

**评分说明**:
- ⭐⭐⭐: 高优先 + 高可行 + 低复杂度 → 纳入 MVP
- ⭐⭐: 中等匹配 → 视资源纳入 MVP 或推迟
- ⭐: 低匹配 → 推迟或排除

## 2. 可行性评估

### 技术可行性

**总体评级: 高（接近确定性）**

本需求为**纯 Markdown 文件重构**，不涉及任何 TypeScript/Node.js 代码变更。技术调研已验证：
- 三个技能名（run、resume、sync）在 Claude Code Plugin 命名空间下合法且不冲突
- Claude Code 自动发现 `skills/*/SKILL.md`，无需修改 Plugin manifest
- 所有 Plugin 组件（agents/、hooks/、scripts/、templates/）与 skills/ 目录完全独立

### 资源评估

- **预估工作量**: 极低——约 5 个文件操作（3 个新建 + 1 个删除 + 1 个目录结构调整）
- **关键技能需求**: Markdown 文本裁剪和组织能力，对 SKILL.md frontmatter 规范的理解
- **外部依赖**: 无新增。零运行时依赖、零开发依赖

### 约束与限制

- **Claude Code Plugin 规范约束**: 每个 SKILL.md 建议控制在 200-300 行（1,500-2,000 words）以内，拆分后三个文件预估 120-350 行，全部符合
- **命名空间约束**: Plugin 技能使用 `plugin-name:skill-name` 格式，不支持自定义别名——旧的 `/speckit-driver-pro` 命令在删除后将不可用
- **初始化逻辑差异约束**: run 和 resume 的初始化虽然共享部分步骤，但 resume 不需要"特性目录准备"而需要额外的"制品扫描"，不宜简单复制

## 3. 风险评估

### 综合风险矩阵

| # | 风险 | 来源 | 概率 | 影响 | 缓解策略 | 状态 |
|---|------|------|------|------|---------|------|
| 1 | 初始化逻辑遗漏（resume 缺少关键步骤） | 技术 | 中 | 高 | 实现时逐行对照原始 L36-L97，resume 包含环境检查+配置加载+prompt 映射，排除特性目录准备 | 待监控 |
| 2 | description 措辞导致 sync 误触发 | 技术+产品 | 中 | 低 | 使用具体动作词和技术术语（"specs/"、"current-spec.md"），避免泛化词汇 | 待监控 |
| 3 | `--rerun` 归属引发用户困惑 | 产品 | 中 | 中 | 归入 run 技能（需完整编排上下文），在 resume 中明确说明不支持重跑 | 已决策 |
| 4 | 向后兼容中断 | 产品 | 低 | 低 | Plugin 未广泛分发，在 README 说明迁移路径 | 已接受 |
| 5 | 上下文预算节省不如预期 | 技术 | 低 | 低 | 即使预算节省有限，命令可发现性和语义清晰度改进仍然成立 | 已接受 |

### 风险分布

- **产品风险**: 2 项（高:0 中:1 低:1）
- **技术风险**: 3 项（高:0 中:2 低:1）
- **总体风险等级**: **低** — 无高概率高影响风险项

## 4. 最终推荐方案

### 推荐架构

**方案 A — 完全独立拆分**（产品调研和技术调研一致推荐）

三个 SKILL.md 各自包含完整的独立逻辑，无文件间引用依赖。选择此方案的产品-技术交叉理由：

| 产品需求 | 技术支撑 |
|---------|---------|
| 命令可发现性提升（用户在 `/` 菜单看到三个独立命令） | Claude Code 自动发现 `skills/*/SKILL.md`，零配置 |
| 上下文预算优化（每个技能仅加载自身内容） | 方案 A 的上下文效率最优，无额外 Read 调用 |
| 渐进式功能发现（sync → run → resume） | `disable-model-invocation` 差异化配置直接支撑 |
| 中断恢复作为独立命令（竞品差异化） | resume 的初始化与 run 存在差异，独立实现更清晰 |

### 推荐技术栈

| 类别 | 选择 | 理由 |
|------|------|------|
| 文件格式 | Markdown (SKILL.md) | Claude Code Plugin 原生格式，零额外工具链 |
| 配置格式 | YAML (frontmatter) | SKILL.md 标准 frontmatter 格式 |
| 迁移策略 | Strangler Fig 模式 | 先创建新技能验证可用，再删除旧技能，降低回滚风险 |
| 设计原则 | SRP + 渐进式披露 | 每个技能单一职责，详细逻辑通过路径引用按需加载 |

### 推荐实施路径

1. **Phase 1 (MVP)**: 创建 run/resume/sync 三个独立 SKILL.md → 验证功能 → 删除旧技能目录
2. **Phase 2 (二期)**: 提取共享逻辑到 `_shared/` 引用目录，添加交叉引用提示
3. **Phase 3 (远期)**: 技能间编排协议、自定义技能组合

## 5. MVP 范围界定

### 最终 MVP 范围

**纳入**:
- **创建 `skills/run/SKILL.md`（~350 行）**: 10 阶段编排+初始化+重试+重跑+模型选择+进度映射。核心功能载体，覆盖主要用户场景
- **创建 `skills/resume/SKILL.md`（~150 行）**: 精简初始化+制品扫描+恢复执行。竞品差异化功能，独立命令提升可见性
- **创建 `skills/sync/SKILL.md`（~120 行）**: 聚合模式完整流程。渐进式采用入口，最低学习成本
- **删除 `skills/speckit-driver-pro/SKILL.md`**: 完成迁移闭环，避免新旧命令共存引起的用户混淆
- **Frontmatter 差异化配置**: run/resume 设置 `disable-model-invocation: true`，sync 保持默认（允许自动触发）

**排除（明确不在 MVP）**:
- **共享工具模块（`_shared/`）**: 仅 60 行重复，维护成本可控，不值得在 MVP 引入额外设计复杂度
- **命令别名**: Claude Code 平台不支持技能别名机制，技术上不可行
- **交叉引用提示**: 增值功能，可在验证 MVP 效果后再添加

### MVP 成功标准

- 在 Claude Code 的 `/speckit-driver-pro:` 补全菜单中，run、resume、sync 三个命令各自可见且 description 正确
- `/speckit-driver-pro:sync` 可独立执行产品规范聚合流程（3 步完成）
- `/speckit-driver-pro:run <需求>` 可执行完整的 10 阶段编排流程
- `/speckit-driver-pro:resume` 可扫描已有制品并从断点恢复
- 旧的 `/speckit-driver-pro:speckit-driver-pro` 命令不再存在

## 6. 结论

### 综合判断

产品调研和技术调研高度一致地支持方案 A（完全独立拆分）。这是一个**低风险、高确定性、高用户价值**的 Markdown 文件重构任务。核心价值来自三个层面：(1) 利用 Claude Code 平台原生命名空间能力实现命令可发现性的质的提升；(2) 每个技能文件自包含，上下文预算占用从 706 行降至 120-350 行（按需加载）；(3) resume 作为独立命令成为竞品差异化亮点。风险集中在初始化逻辑的完整性拆分上，通过逐行对照原始代码即可缓解。

### 置信度

| 维度 | 置信度 | 说明 |
|------|--------|------|
| 产品方向 | 高 | 行业趋势、竞品分析、用户场景验证三重确认，拆分符合 CLI/AI 工具的普遍最佳实践 |
| 技术方案 | 高 | 纯 Markdown 文件操作，零代码变更，零新增依赖，Claude Code 平台原生支持 |
| MVP 范围 | 高 | 产品和技术调研对 MVP 范围达成完全共识，功能边界清晰，无灰色地带 |

### 后续行动建议

- 确认推荐方案后，进入需求规范阶段（specify）
- 需求规范应特别关注三个 SKILL.md 的内容归属表（技术调研已提供详细映射）
- 实现阶段建议采用 Strangler Fig 策略：先创建 → 验证 → 再删除
